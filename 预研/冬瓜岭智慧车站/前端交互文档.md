# 前端交互文档

此文档作为前端直接通过iframe嵌入后，通过postmessage进行交互的说明文档，所有初始化方法返回的均为Promise对象；

![image-20200921173933175](C:\Users\jevin\AppData\Roaming\Typora\typora-user-images\image-20200921173933175.png)

### 初始化

1. **初始化参数**

   通过iframe链接传入的初始化参数，camera是一个对象，因此传入的时候需要将其序列化处理。

   例如：

   ```js
   const cameraInfo = {
   	"name": "冬瓜岭",
       "x": 22313323.32,
       "y": 3234324,
   };
   
   const url = `http://127.0.0.1/map?floor=F1&bg=#ccc&camera=${encodeURI(JSON.stringify(cameraInfo))}`;
   
   ```

   | 参数名称 | 类型   | 描述                                                         |
   | -------- | ------ | ------------------------------------------------------------ |
   | floor    | string | 显示站内层数：<br />1. 只显示第一层：F1<br />2. 只显示第二层：F2<br />3. 显示全部：不传或者传ALL |
   | bg       | string | 显示背景颜色，默认为：#CCC                                   |
   | camera   | Object | 初始化视角的信息，该信息可以工具中获取当前视角信息           |


2. **初始化交互**

   由于三维场景需要初始化完成后才能调用，因此B端需要在页面初始化发送:

   ```javascript
   {
       "action": "connect",
       "payload": 0,
   }
   ```

   待接收到以下消息后才能进行功能的调用：

   ```javascript
   {
       "action": "connect",
       "payload": 1,
   }
   ```

   

### 工具

1. **获取当前视角信息**

   ```javascript
   // 传参
   {
       "action": "tool",
       "payload": "current-camera"
   }
   // 返回参数
   {
       "action": "current-camera",
       "payload": {
           "floor": "",
           "x": "",
           "y": "",
           "z": "",
       }  
   }
   
   ```

   

2. **地图全屏**

   ```js
   // 传参
   {
       "action": "tool",
       "payload": "fullscreen"
   }
   ```
   
   

3. **锁定角度**

   锁定当前视角，仅可在当前视角做移动，拖拽操作返回当前视角信息

   ```javascript
   // 传参
   {
       "action": "tool",
       "payload": "lock-camera"
   }
   ```
   
   
   
4. **重置视角**

   ```javascript
   // 传参
   {
       "action": "tool",
       "payload": "reset-camera"
   }
   ```
   
   

### 功能

1. **视角移动到指定设备/位置**

   如果传了deviceId,则默认视角移动到该设备所在视角，如果无deviceId，存在其他参数，则视角移动到该参数对应的视角，所有参数可通过获取当前视角信息获取
   
   ```javascript
   // 传参
   {
       "action": "move",
       "payload": {
           "deviceId": "234",
           "floor": "F1",
           "x": "",
           "y": "",
           "": "",
       }
   }
   ```

2. **设备分层显示**

	设备分类：PIS、CCTV、PSD、AFC、BAS_1(传感器)、BAS_2（扶梯）、Access（门禁）

    ```javascript
    // 传参
    {
        "action": "device-layer",
        "payload": ['PIS']
    }
    ```



3. **站内巡检**
    
    ```javascript
    // 传参
    {
        "action": "inspection",
        "payload": {
            "line": 1
        }
    }
    ```

